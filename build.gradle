/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

buildscript {
    dependencies {
        classpath 'com.h2database:h2:1.4.197'        
        classpath 'com.ibm.db2:jcc:11.5.0.0'
    }
}

plugins {
    id "org.flywaydb.flyway" version "6.4.2"
}

loadConfiguration()

task printProps << {
    println "Driver:  $config_env.flywayProperties.driver"
    println "URL:  $config_env.flywayProperties.url"
    println "User:  $config_env.flywayProperties.user"
    println "Password:  $config_env.flywayProperties.password"
    println "Locations:  $config_common.flywayProperties.locations"
}

def loadConfiguration() {
    def environment = hasProperty('env') ? env : 'dev'
    project.ext.environment = environment
    println "Environment is set to $environment"

    def configFile = file('environment.groovy')
    println configFile.toURL()

    def config_common = new ConfigSlurper("common").parse(configFile.toURL())
    def config_env = new ConfigSlurper("$environment").parse(configFile.toURL())   
    project.ext.config_common = config_common
    project.ext.config_env = config_env
}

flyway {
    driver = "${config_env.flywayProperties.driver}"
    url = "${config_env.flywayProperties.url}"
    user = "${config_env.flywayProperties.user}"
    password = "${config_env.flywayProperties.password}"
    locations = "${config_common.flywayProperties.locations}".split(',')
    schemas = "${config_env.flywayProperties.schemas}".split(',')
    table = "${config_common.flywayProperties.table}"
}